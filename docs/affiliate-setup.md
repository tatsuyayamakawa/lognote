# コード埋め込み機能

記事内にアフィリエイトコード、広告コードなど、任意のHTMLコードを簡単に埋め込める機能です。

## 機能概要

- **対応コード**: Amazon、楽天、A8.net、もしもアフィリエイト、Google AdSense、その他HTMLコード
- **自動判定**: コードから自動的にプロバイダーを判別・表示
- **2つの挿入モード**:
  - シンプル: コードのみを埋め込む
  - 詳細情報付き: タイトル、画像、価格などの情報も一緒に表示

## 使い方

### 1. エディタでコード埋め込みボックスを挿入

1. 記事エディタのツールバーから **🛍️ ショッピングバッグアイコン** をクリック
2. コード埋め込みダイアログが開きます

### 2. 挿入モードを選択

#### シンプルモード

HTMLコードをそのまま貼り付けます。プロバイダーは自動的に判別されます。

**手順:**
1. 「シンプル」タブを選択
2. 埋め込みコード入力欄にHTMLコードを貼り付け
3. 「挿入」ボタンをクリック

**例:**
```html
<iframe src="..." width="120" height="240"></iframe>
```

または

```html
<a href="...">商品リンク</a>
```

#### 詳細情報付きモード

商品の詳細情報も一緒に入力すると、読者に見やすいレイアウトで表示されます。

**手順:**
1. 「詳細情報付き」タブを選択
2. 各フィールドに情報を入力:
   - **アフィリエイトコード** (必須): プロバイダーから取得したHTMLコード
   - **商品名**: 商品の名前
   - **商品画像URL**: 商品画像のURL
   - **価格**: 価格表示（例: ¥3,990）
   - **商品ページURL**: 商品ページへのリンク
3. 「挿入」ボタンをクリック

### 4. エディタでの表示

エディタ内では以下のように表示されます:

- プロバイダーのバッジ（カラー付き）
- 商品画像（入力した場合）
- 商品名（入力した場合）
- 価格（入力した場合）
- アフィリエイトコードのプレビュー

### 5. 公開ページでの表示

公開されたページでは:
- 詳細情報付きの場合: 見やすいカード形式で表示
- シンプル挿入の場合: プロバイダーバッジ付きで表示
- **実際のアフィリエイトコードが埋め込まれ、リンクやバナーが機能します**

## 対応するアフィリエイトコード形式

以下のような形式のコードに対応しています:

### iframe形式
```html
<iframe src="https://..." width="120" height="240"></iframe>
```

### リンク形式
```html
<a href="https://...">商品名</a>
```

### script + div形式
```html
<div id="..."></div>
<script src="https://..."></script>
```

### 複数タグの組み合わせ
```html
<a href="..."><img src="..." /></a>
<script>...</script>
```

## プロバイダー別の特徴

### Amazon
- カラー: オレンジ (FF9900)
- Product Advertising API のリンクに対応

### 楽天市場
- カラー: レッド (BF0000)
- 楽天アフィリエイトのバナー・テキストリンクに対応

### A8.net
- カラー: ブルー (0066CC)
- 広告リンク、バナー広告に対応

### もしもアフィリエイト
- カラー: スカイブルー (00A0E9)
- かんたんリンク、バナー広告に対応

## Tips

### 💡 おすすめの使い方

1. **商品レビュー記事**: 詳細情報付きモードで商品画像と価格を表示
2. **リンク集**: シンプル挿入モードで複数のリンクを並べる
3. **比較記事**: 複数のアフィリエイトボックスを並べて商品を比較

### ⚠️ 注意点

- アフィリエイトコードは必ず各プロバイダーの規約に従って使用してください
- 不適切なコードを貼り付けるとページの表示が崩れる可能性があります
- scriptタグを含むコードも自動的に実行されます

### 🔧 トラブルシューティング

**アフィリエイトリンクが表示されない場合:**
- アフィリエイトコードが正しく貼り付けられているか確認
- プロバイダー側でリンクが有効か確認
- ブラウザの広告ブロッカーが有効になっていないか確認

**レイアウトが崩れる場合:**
- アフィリエイトコードにスタイルが含まれている可能性があります
- シンプル挿入モードを試してみてください

## 技術的な詳細

### エディタ内の動作
- TipTapのカスタムNode拡張として実装
- React NodeViewでプレビューを表示
- JSONContentとして保存

### 公開ページでの動作
- data属性からアフィリエイト情報を読み取り
- React Portal を使用してコンポーネントをレンダリング
- scriptタグは自動的に検出・実行
- SEO対策として適切なHTML構造で出力

## サンプルコード

### シンプルなAmazonリンク
```
プロバイダー: Amazon
コード: <a href="https://www.amazon.co.jp/dp/B08...">商品を見る</a>
```

### 詳細情報付き楽天商品
```
プロバイダー: 楽天市場
コード: <a href="https://hb.afl.rakuten.co.jp/..."><img src="..." /></a>
商品名: Anker PowerCore 10000
商品画像: https://example.com/image.jpg
価格: ¥3,990
商品URL: https://www.amazon.co.jp/dp/...
```

## まとめ

アフィリエイトコード埋め込み機能を使うことで:
- ✅ 記事内に簡単にアフィリエイトリンクを追加できる
- ✅ 見やすいデザインで商品を紹介できる
- ✅ 複数のプロバイダーに対応
- ✅ エディタ内でプレビュー確認が可能
- ✅ 公開ページで実際のアフィリエイトコードが動作

収益化を目指すブログ運営に最適です!
